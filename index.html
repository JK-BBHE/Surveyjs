<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <title>25XXX ‚Äì Projektname ‚Äì Erfassungsbogen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- SurveyJS CSS & JS -->
    <link
      href="https://unpkg.com/survey-core/survey-core.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <script src="https://unpkg.com/survey-core/survey.core.min.js"></script>
    <script src="https://unpkg.com/survey-core/survey.i18n.min.js"></script>
    <script src="https://unpkg.com/survey-js-ui/survey-js-ui.min.js"></script>

    <!-- Dein Survey-JSON als JS -->
    <script src="survey.js"></script>

    <style>
    /* === SurveyJS Theme Overrides (red instead of green) === */
    :root {
      /* Primary color (buttons, active elements, progress bar, etc.) */
      --sjs-primary-backcolor: #c62828;
      --sjs-primary-backcolor-dark: #8e0000;
      --sjs-primary-backcolor-light: #ef5350;
      --sjs-primary-forecolor: #ffffff;

      /* Optional: border and focus colors slightly reddish */
      --sjs-border-default: #c62828;
      --sjs-border-light: #ffcdd2;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      margin: 0;
      min-height: 100vh;

      /* === Background image with dark transparent overlay === */
      background:
        linear-gradient(rgba(0, 0, 0, 0.25), rgba(0, 0, 0, 0.25)),
        url("https://images.pexels.com/photos/532192/pexels-photo-532192.jpeg")/*"https://images.pexels.com/photos/532192/pexels-photo-532192.jpeg")beispiel.png*/
          center / cover fixed no-repeat;
    }

    h1 {
      font-size: 1.6rem;
      margin: 1.5rem auto 1rem;
      max-width: 900px;
      color: #c62828; /* red title */
    }

    #surveyContainer {
      max-width: 900px;
      margin: 0 auto 2rem;
      background: rgba(255, 255, 255, 0.95); /* slight transparency */
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.18);
      backdrop-filter: blur(4px); /* subtle glass effect, optional */
    }

    #resultsBox {
      max-width: 900px;
      margin: 0 auto 2rem;
    }

    #resultJson {
      width: 100%;
      min-height: 200px;
      font-family: monospace;
      font-size: 0.9rem;
      display: none;
    }

    #downloadBtn {
      display: none;
      margin-top: 0.5rem;
    }
  </style>
  </head>

  <body>
    <h1>25XXX ‚Äì Projektname ‚Äì Erfassungsbogen f√ºr ein potenzielles Nahw√§rmenetz</h1>

    <div id="surveyContainer"></div>

    <div id="resultsBox">
      <p>Export als JSON (f√ºr eine ausgef√ºllte Umfrage):</p>
      <textarea id="resultJson" readonly></textarea><br />
      <button id="downloadBtn">Antworten als JSON herunterladen</button>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
      if (typeof surveyJson === "undefined") {
        document.getElementById("surveyContainer").innerText =
          "surveyJson ist nicht definiert. Bitte survey.js pr√ºfen.";
        return;
      }

      const survey = new Survey.Model(surveyJson);
      survey.locale = "de";

      const resultTextarea = document.getElementById("resultJson");
      const downloadBtn = document.getElementById("downloadBtn");

      // üëâ HIER deine Supabase-Daten einsetzen
      const SUPABASE_URL = "https://jhqabvasnhbvemmhijob.supabase.co";
      const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpocWFidmFzbmhidmVtbWhpam9iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxMDE5MzgsImV4cCI6MjA3OTY3NzkzOH0.mWFLJJQA63PoAi3nBaBIFUBiXmbpv03iRQSqrahWwMw";
      const SUPABASE_TABLE = "survey_responses";

      survey.onComplete.add(function (sender) {
        const data = sender.data; // Antworten als JS-Objekt
        const jsonStr = JSON.stringify(data, null, 2);

        // Payload f√ºr Supabase
        const payload = {
          data: data
          // du kannst hier weitere Felder erg√§nzen, z.B.:
          // user_agent: navigator.userAgent
          // project_code: "25XXX"
        };

        // REST-Endpoint f√ºr die Tabelle
        const url = `${SUPABASE_URL}/rest/v1/${SUPABASE_TABLE}`;

        // Daten an Supabase senden
        fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            apikey: SUPABASE_ANON_KEY,
            Authorization: "Bearer " + SUPABASE_ANON_KEY,
            Prefer: "return=minimal" // wir brauchen keine Antwort
          },
          body: JSON.stringify(payload)
        })
          .then(() => {
            // hier k√∂nnte man optional eine Erfolgsmeldung loggen
            console.log("Antwort in Supabase gespeichert");
          })
          .catch((err) => {
            console.error("Fehler beim Speichern in Supabase:", err);
          });

        alert("Vielen Dank f√ºr Ihre Teilnahme!");

        // JSON im Textfeld anzeigen
        resultTextarea.value = jsonStr;
        resultTextarea.style.display = "block";
        downloadBtn.style.display = "inline-block";

        // Button zum Herunterladen einer JSON-Datei
        downloadBtn.onclick = function () {
          const blob = new Blob([jsonStr], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "survey-result.json";
          a.click();
          URL.revokeObjectURL(url);
        };
      });

      survey.render(document.getElementById("surveyContainer"));
    });
  </script>
  </body>
</html>
