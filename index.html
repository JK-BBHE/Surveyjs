<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <title>25XXX â€“ Projektname â€“ Erfassungsbogen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- SurveyJS CSS & JS -->
    <link
      href="https://unpkg.com/survey-core/survey-core.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <script src="https://unpkg.com/survey-core/survey.core.min.js"></script>
    <script src="https://unpkg.com/survey-core/survey.i18n.min.js"></script>
    <script src="https://unpkg.com/survey-js-ui/survey-js-ui.min.js"></script>

    <!-- Dein Survey-JSON als JS -->
    <script src="survey.js"></script>

    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        margin: 2rem;
        background: #f5f5f5;
      }
      h1 {
        font-size: 1.4rem;
        margin-bottom: 1rem;
      }
      #surveyContainer {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }
      #resultsBox {
        max-width: 900px;
        margin: 2rem auto 0;
      }
      #resultJson {
        width: 100%;
        min-height: 200px;
        font-family: monospace;
        font-size: 0.9rem;
        display: none;
      }
      #downloadBtn {
        display: none;
        margin-top: 0.5rem;
      }
    </style>
  </head>

  <body>
    <h1>25XXX â€“ Projektname â€“ Erfassungsbogen fÃ¼r ein potenzielles NahwÃ¤rmenetz</h1>

    <div id="surveyContainer"></div>

    <div id="resultsBox">
      <p>Export als JSON (fÃ¼r eine ausgefÃ¼llte Umfrage):</p>
      <textarea id="resultJson" readonly></textarea><br />
      <button id="downloadBtn">Antworten als JSON herunterladen</button>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        if (typeof surveyJson === "undefined") {
          document.getElementById("surveyContainer").innerText =
            "surveyJson ist nicht definiert. Bitte survey.js prÃ¼fen.";
          return;
        }

        const survey = new Survey.Model(surveyJson);

        // ðŸ”¤ SurveyJS-UI auf Deutsch (Buttons, Fehlermeldungen, etc.)
        survey.locale = "de";

        const resultTextarea = document.getElementById("resultJson");
        const downloadBtn = document.getElementById("downloadBtn");

        // âœ… Was beim Abschluss passieren soll
        survey.onComplete.add(function (sender) {
          const data = sender.data; // Antworten als JS-Objekt
          const jsonStr = JSON.stringify(data, null, 2); // hÃ¼bsch formatiert

          alert("Vielen Dank fÃ¼r Ihre Teilnahme!"); // deutsche Meldung

          // JSON im Textfeld anzeigen, damit du es kopieren kannst
          resultTextarea.value = jsonStr;
          resultTextarea.style.display = "block";
          downloadBtn.style.display = "inline-block";

          // Button zum Herunterladen einer JSON-Datei
          downloadBtn.onclick = function () {
            const blob = new Blob([jsonStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "survey-result.json";
            a.click();
            URL.revokeObjectURL(url);
          };
        });

        // Survey rendern
        survey.render(document.getElementById("surveyContainer"));
      });
    </script>
  </body>
</html>
